<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>å°æƒ…ç·’è¨˜éŒ„å™¨</title>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      max-width: 520px;
      margin: 32px auto;
      padding: 16px 20px 32px;
      border-radius: 14px;
      box-shadow: 0 4px 18px rgba(0, 0, 0, 0.08);
      background: #fafafa;
    }
    h1 {
      font-size: 22px;
      margin-bottom: 4px;
      text-align: center;
    }
    .subtitle {
      text-align: center;
      font-size: 12px;
      color: #777;
      margin-bottom: 16px;
    }
    .card {
      background: #ffffff;
      border-radius: 10px;
      padding: 12px 14px;
      margin-bottom: 12px;
      border: 1px solid #eee;
    }
    .card-title {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 8px;
    }
    label {
      font-size: 13px;
      display: block;
      margin-bottom: 4px;
    }
    input[type="date"],
    select,
    textarea {
      width: 100%;
      box-sizing: border-box;
      padding: 6px 8px;
      font-size: 13px;
      border-radius: 6px;
      border: 1px solid #ccc;
      margin-bottom: 8px;
    }
    textarea {
      resize: vertical;
      min-height: 60px;
      max-height: 200px;
    }
    button {
      border: none;
      border-radius: 8px;
      padding: 8px 14px;
      font-size: 13px;
      cursor: pointer;
    }
    #saveBtn {
      background: #4caf50;
      color: white;
      width: 100%;
      margin-top: 4px;
    }
    #saveBtn:hover {
      opacity: 0.92;
    }
    .hint {
      font-size: 11px;
      color: #888;
      margin-top: 4px;
    }
    .entry {
      font-size: 13px;
      display: flex;
      flex-direction: column;
      gap: 2px;
      padding-top: 4px;
      padding-bottom: 4px;
    }
    .entry-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-weight: 500;
    }
    .entry-date {
      font-size: 12px;
      color: #666;
    }
    .entry-mood {
      font-size: 13px;
    }
    .entry-note {
      font-size: 12px;
      color: #555;
      margin-top: 2px;
      white-space: pre-wrap;
    }
    .tag {
      font-size: 11px;
      padding: 2px 6px;
      border-radius: 999px;
      background: #f1f1f1;
      color: #555;
    }
    #weeklySummary {
      font-size: 13px;
      line-height: 1.6;
    }
    .summary-number {
      font-weight: 600;
    }
    .summary-mood {
      font-size: 14px;
      font-weight: 600;
    }
    .empty-text {
      font-size: 12px;
      color: #888;
      font-style: italic;
    }
  </style>
</head>
<body>
  <h1>å°æƒ…ç·’è¨˜éŒ„å™¨</h1>
  <div class="subtitle">è¨˜éŒ„ä¸€ä¸‹ä»Šå¤©çš„å¿ƒæƒ…ï¼Œä¹‹å¾Œå†å›é ­çœ‹ä¹Ÿå¯ä»¥æº«æŸ”å°å¾…è‡ªå·± ğŸ’­</div>

  <!-- å¡«å¯«å€ -->
  <div class="card">
    <div class="card-title">ä»Šå¤©çš„ç´€éŒ„</div>

    <label for="dateInput">æ—¥æœŸ</label>
    <input id="dateInput" type="date" />

    <label for="moodSelect">ä»Šå¤©çš„æ•´é«”æ„Ÿè¦º</label>
    <select id="moodSelect">
      <option value="">è«‹é¸æ“‡</option>
      <option value="1">ğŸ˜£ å¾ˆç³Ÿï¼Œå¾ˆç—›è‹¦</option>
      <option value="2">â˜ï¸ ä¸å¤ªå¥½ï¼Œæœ‰é»ä½è½</option>
      <option value="3">ğŸ˜ æ™®æ™®é€šé€š</option>
      <option value="4">ğŸ™‚ é‚„ä¸éŒ¯ï¼Œæ»¿ç©©å®š</option>
      <option value="5">âœ¨ å¾ˆå¥½ï¼Œå¾ˆé–‹å¿ƒï¼æ”¾é¬†</option>
    </select>

    <label for="noteInput">æƒ³å¤šèªªå¹¾å¥ä¹Ÿå¯ä»¥ï¼ˆå¯ç©ºç™½ï¼‰</label>
    <textarea
      id="noteInput"
      placeholder="ä¾‹å¦‚ï¼šä»Šå¤©é›–ç„¶å¾ˆç´¯ï¼Œä½†æœ‰å¥½å¥½æŠŠæŸä»¶äº‹å®Œæˆï¼ä»Šå¤©è¢«ä»€éº¼è©±å‚·åˆ°äº†â€¦"
    ></textarea>

    <button id="saveBtn">å„²å­˜ä»Šå¤©çš„å¿ƒæƒ…</button>
    <div class="hint">ğŸ“Œ åŒä¸€å¤©é‡è¤‡å„²å­˜æœƒè¦†è“‹ä»Šå¤©çš„ç´€éŒ„ã€‚</div>
  </div>

  <!-- æœ€è¿‘ 7 å¤©å°çµ -->
  <div class="card">
    <div class="card-title">æœ€è¿‘ 7 å¤©å°çµï¼ˆè‡ªå‹•çµ±æ•´ï¼‰</div>
    <div id="weeklySummary" class="empty-text">ç›®å‰é‚„æ²’æœ‰è³‡æ–™ã€‚</div>
  </div>

  <!-- æ­·å²ç´€éŒ„ -->
  <div class="card">
    <div class="card-title">å…¨éƒ¨ç´€éŒ„</div>
    <div id="entriesList" class="empty-text">é‚„æ²’æœ‰ä»»ä½•ç´€éŒ„ï¼Œå¾ä»Šå¤©é–‹å§‹ä¹Ÿå¯ä»¥ ğŸ˜Š</div>
  </div>

  <script>
    const STORAGE_KEY = "moodEntries_v1";

    const dateInput = document.getElementById("dateInput");
    const moodSelect = document.getElementById("moodSelect");
    const noteInput = document.getElementById("noteInput");
    const saveBtn = document.getElementById("saveBtn");
    const weeklySummaryDiv = document.getElementById("weeklySummary");
    const entriesListDiv = document.getElementById("entriesList");

    // è®“æ—¥æœŸé è¨­ç‚ºä»Šå¤©
    function setToday() {
      const today = new Date();
      const yyyy = today.getFullYear();
      const mm = String(today.getMonth() + 1).padStart(2, "0");
      const dd = String(today.getDate()).padStart(2, "0");
      dateInput.value = `${yyyy}-${mm}-${dd}`;
    }

    // å¾ localStorage è®€å–è³‡æ–™
    function loadEntries() {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (!raw) return [];
      try {
        const data = JSON.parse(raw);
        if (Array.isArray(data)) return data;
        return [];
      } catch (e) {
        console.error("è§£ææƒ…ç·’è³‡æ–™å¤±æ•—", e);
        return [];
      }
    }

    // å¯«å› localStorage
    function saveEntries(entries) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(entries));
    }

    function moodToText(mood) {
      switch (Number(mood)) {
        case 1:
          return "ğŸ˜£ å¾ˆç³Ÿï¼Œå¾ˆç—›è‹¦";
        case 2:
          return "â˜ï¸ ä¸å¤ªå¥½ï¼Œæœ‰é»ä½è½";
        case 3:
          return "ğŸ˜ æ™®æ™®é€šé€š";
        case 4:
          return "ğŸ™‚ é‚„ä¸éŒ¯ï¼Œæ»¿ç©©å®š";
        case 5:
          return "âœ¨ å¾ˆå¥½ï¼Œå¾ˆé–‹å¿ƒï¼æ”¾é¬†";
        default:
          return "";
      }
    }

    // å„²å­˜ç•¶å¤©ç´€éŒ„
    function handleSave() {
      const date = dateInput.value;
      const mood = moodSelect.value;
      const note = noteInput.value.trim();

      if (!date) {
        alert("è«‹å…ˆé¸æ“‡æ—¥æœŸ");
        return;
      }
      if (!mood) {
        alert("è«‹å…ˆé¸æ“‡ä»Šå¤©çš„å¿ƒæƒ…");
        return;
      }

      let entries = loadEntries();

      // æª¢æŸ¥æœ‰æ²’æœ‰åŒä¸€å¤©ï¼Œè‹¥æœ‰å°±è¦†è“‹
      const existingIndex = entries.findIndex((e) => e.date === date);
      const newEntry = { date, mood: Number(mood), note };

      if (existingIndex >= 0) {
        entries[existingIndex] = newEntry;
      } else {
        entries.push(newEntry);
      }

      // ä¾æ—¥æœŸæ’åºï¼ˆæ–°çš„åœ¨å‰ï¼‰
      entries.sort((a, b) => (a.date < b.date ? 1 : -1));

      saveEntries(entries);
      renderEntries();
      renderWeeklySummary();

      // å°æé†’
      alert("å·²å„²å­˜ä»Šå¤©çš„å¿ƒæƒ… ğŸŒ±");
    }

    // é¡¯ç¤ºå…¨éƒ¨ç´€éŒ„
    function renderEntries() {
      const entries = loadEntries();

      if (entries.length === 0) {
        entriesListDiv.innerHTML = '<div class="empty-text">é‚„æ²’æœ‰ä»»ä½•ç´€éŒ„ã€‚</div>';
        return;
      }

      entriesListDiv.innerHTML = "";
      entries.forEach((entry) => {
        const wrapper = document.createElement("div");
        wrapper.className = "entry";

        const header = document.createElement("div");
        header.className = "entry-header";

        const dateSpan = document.createElement("span");
        dateSpan.className = "entry-date";
        dateSpan.textContent = entry.date;

        const moodSpan = document.createElement("span");
        moodSpan.className = "entry-mood";
        moodSpan.textContent = moodToText(entry.mood);

        header.appendChild(dateSpan);
        header.appendChild(moodSpan);
        wrapper.appendChild(header);

        if (entry.note) {
          const noteDiv = document.createElement("div");
          noteDiv.className = "entry-note";
          noteDiv.textContent = entry.note;
          wrapper.appendChild(noteDiv);
        }

        entriesListDiv.appendChild(wrapper);
      });
    }

    // è¨ˆç®—æœ€è¿‘ 7 å¤©çš„å°çµï¼ˆæŠŠæœ€è¿‘ 7 å¤©ç•¶ä½œã€Œé€™é€±ã€ï¼‰
    function renderWeeklySummary() {
      const entries = loadEntries();
      if (entries.length === 0) {
        weeklySummaryDiv.className = "empty-text";
        weeklySummaryDiv.textContent = "ç›®å‰é‚„æ²’æœ‰è³‡æ–™ã€‚";
        return;
      }

      const today = new Date();
      const start = new Date();
      start.setDate(today.getDate() - 6); // æœ€è¿‘ 7 å¤©ï¼ˆå«ä»Šå¤©ï¼‰

      const weeklyEntries = entries.filter((entry) => {
        const d = new Date(entry.date + "T00:00:00");
        return d >= start && d <= today;
      });

      if (weeklyEntries.length === 0) {
        weeklySummaryDiv.className = "empty-text";
        weeklySummaryDiv.textContent = "æœ€è¿‘ 7 å¤©å…§æ²’æœ‰ç´€éŒ„ã€‚å¯ä»¥å¾ä»Šå¤©é–‹å§‹è¨˜å°±å¥½ ğŸ’¡";
        return;
      }

      const count = weeklyEntries.length;
      const sumMood = weeklyEntries.reduce((sum, e) => sum + Number(e.mood), 0);
      const avgMood = sumMood / count;

      let avgText = "";
      if (avgMood < 2) {
        avgText = "é€™é€±æ•´é«”åè¾›è‹¦ï¼Œè¦å¥½å¥½ç…§é¡§è‡ªå·± ğŸ«‚";
      } else if (avgMood < 3) {
        avgText = "é€™é€±æœ‰é»é›£å—çš„æ™‚å€™ï¼Œå¯ä»¥è©¦è‘—å¤šå®‰æ’ä¼‘æ¯æ™‚é–“ã€‚";
      } else if (avgMood < 4) {
        avgText = "é€™é€±å¤§è‡´æ™®é€šï¼Œå¶çˆ¾èµ·ä¼æ˜¯æ­£å¸¸çš„ã€‚";
      } else {
        avgText = "é€™é€±æ•´é«”ç‹€æ…‹ä¸éŒ¯ï¼Œè¾›è‹¦çš„è‡ªå·±å€¼å¾—è¢«ç¨±è®š âœ¨";
      }

      weeklySummaryDiv.className = "";
      weeklySummaryDiv.innerHTML = `
        <div>
          æœ€è¿‘ 7 å¤©å…§ï¼Œä½ ä¸€å…±ç•™ä¸‹äº†
          <span class="summary-number">${count}</span> ç­†ç´€éŒ„ã€‚
        </div>
        <div>
          å¹³å‡å¿ƒæƒ…æŒ‡æ•¸ç´„ç‚º
          <span class="summary-mood">${avgMood.toFixed(1)} / 5</span>ã€‚
        </div>
        <div style="margin-top:4px;">
          ${avgText}
        </div>
        <div class="hint" style="margin-top:6px;">
          ğŸ“Œ é€™è£¡å…ˆç”¨ã€Œæœ€è¿‘ 7 å¤©ã€ç•¶æˆä¸€é€±çš„ç¯„åœã€‚ä¹‹å¾Œå¦‚æœä½ æƒ³æ”¹æˆã€Œæ˜ŸæœŸä¸€ï½æ˜ŸæœŸæ—¥ã€ï¼Œæˆ‘å€‘ä¹Ÿå¯ä»¥ä¸€èµ·èª¿æ•´ã€‚
        </div>
      `;
    }

    // ç¶å®šäº‹ä»¶
    saveBtn.addEventListener("click", handleSave);

    // åˆå§‹åŒ–
    setToday();
    renderEntries();
    renderWeeklySummary();
  </script>
</body>
</html>

